//To avoid co-dependency tables
CREATE TYPE dept_t
/

CREATE TYPE emp_t AS OBJECT (
EMPNO CHAR(6),
FIRSTNAME VARCHAR2(12),
LASTNAME VARCHAR2(15),
WORKDEPT REF dept_t,
SEX CHAR(1),
BIRTHDATE DATE,
SALARY NUMBER(8,2)
)
/

CREATE TYPE dept_t AS OBJECT (
DEPTNO CHAR(3),
DEPTNAME VARCHAR2(36),
MGRNO REF emp_t,
ADMRDEPT REF dept_t
)
/

CREATE TABLE emp OF emp_t(
CONSTRAINT emp_pk PRIMARY KEY(EMPNO),
CONSTRAINT emp_fname FIRSTNAME NOT NULL,
CONSTRAINT emp_lname LASTNAME NOT NULL,
CONSTRAINT emp_sex_ck CHECK (SEX='M' OR SEX='m' OR SEX='F' OR SEX='f')
)
/

CREATE TABLE dept OF dept_t(
CONSTRAINT dept_pk PRIMARY KEY(DEPTNO),
CONSTRAINT dept_name DEPTNAME NOT NULL,
CONSTRAINT dept_mgrno_fk FOREIGN KEY(MGRNO) REFERENCES emp,
CONSTRAINT dept_admrdpt_fk FOREIGN KEY(ADMRDEPT) REFERENCES dept
)
/

ALTER TABLE emp
ADD CONSTRAINT emp_workdept_fk FOREIGN KEY(WORKDEPT) REFERENCES dept
/

INSERT INTO dept VALUES(dept_t('A00','SPIFFY COMPUTER SERVICE DIV.', null, null))
/

INSERT INTO dept VALUES(dept_t('B01','PLANNING', null, (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'A00')))
/

UPDATE dept d
SET d.ADMRDEPT = (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'A00')
WHERE d.DEPTNO = 'A00'
/

INSERT INTO dept VALUES(dept_t('C01','INFORMATION CENTRE', null, (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'A00')))
/

INSERT INTO dept VALUES(dept_t('D01','DEVELOPMENT CENTRE', null, (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'C01')))
/



INSERT INTO emp VALUES (emp_t('000010','CHRISTINE','HAAS', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'A00'),'F','14-AUG-1953',72750))
/

INSERT INTO emp VALUES (emp_t('000020','MICHAEL','THOMPSON', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'B01'), 'M', '02-FEB-1968',61250))
/

INSERT INTO emp VALUES (emp_t('000030','SALLY','KWAN', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'C01'), 'F', '11-MAY-1971',58250))
/

INSERT INTO emp VALUES (emp_t('000060','IRVING','STERN', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'D01'), 'M', '07-JUL-1965',55555))
/

INSERT INTO emp VALUES (emp_t('000070','EVA','PULASKI', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'D01'), 'F', '26-MAY-1973',56170))
/

INSERT INTO emp VALUES (emp_t('000050','JOHN','GEYER', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'C01'), 'M', '15-SEP-1955',60175))
/

INSERT INTO emp VALUES (emp_t('000090','EILEEN','HENDERSON', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'B01'), 'F', '15-MAY-1961',49750))
/

INSERT INTO emp VALUES (emp_t('000100','THEODORE','SPENSER', (SELECT REF(d) FROM dept d WHERE d.DEPTNO = 'B01'), 'M', '18-DEC-1976',46150))
/


UPDATE dept d
SET d.MGRNO = (SELECT REF(e) FROM emp e WHERE e.EMPNO= '000010')
WHERE d.DEPTNO = 'A00'
/

UPDATE dept d
SET d.MGRNO = (SELECT REF(e) FROM emp e WHERE e.EMPNO= '000020')
WHERE d.DEPTNO = 'B01'
/

UPDATE dept d
SET d.MGRNO = (SELECT REF(e) FROM emp e WHERE e.EMPNO = '000030')
WHERE d.DEPTNO = 'C01'
/

UPDATE dept d
SET d.MGRNO = (SELECT REF(e) FROM emp e WHERE e.EMPNO = '000060')
WHERE d.DEPTNO = 'D01'
/



Answers

(a)
SELECT d.DEPTNAME, d.MGRNO.LASTNAME
FROM DEPT d
/

(b)
SELECT e.EMPNO, e.LASTNAME, e.WORKDEPT.DEPTNAME
FROM EMP e
/

(c)
SELECT d.DEPTNO, d.DEPTNAME, d.ADMRDEPT.DEPTNAME
FROM DEPT d
/

(d)
SELECT d.DEPTNO, d.DEPTNAME, d.ADMRDEPT.DEPTNAME, d.ADMRDEPT.MGRNO.LASTNAME
FROM DEPT d
/

(e)
SELECT e.EMPNO, e.FIRSTNAME, e.LASTNAME, e.SALARY, e.WORKDEPT.MGRNO.LASTNAME, e.WORKDEPT.MGRNO.SALARY
FROM EMP e
/

(f)
SELECT e.WORKDEPT.DEPTNAME, e.SEX, (SUM(e.SALARY)/COUNT(e.SEX))
FROM Emp e
GROUP BY e.SEX, e.WORKDEPT.DEPTNAME
ORDER BY e.WORKDEPT.DEPTNAME
/
